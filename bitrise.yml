---
format_version: '7'
default_step_lib_source: https://github.com/bitrise-io/bitrise-steplib.git
project_type: other
trigger_map:
    - push_branch: "*"
      workflow: test
    - tag: v*.*.*
      workflow: deploy
workflows:
    test:
        steps:
            - activate-ssh-key@4.0.3:
                  run_if: '{{getenv "SSH_RSA_PRIVATE_KEY" | ne ""}}'
            - git-clone@4.0.14: {}
            - cache-pull: {}
            - install-bundler@1.0.0: {}
            - fastlane@2.4.0:
                  inputs:
                      - lane: android test
            - cache-push:
                  inputs:
                      - cache_paths: |-
                            $HOME/.gradle
                            ./.gradle
                      - ignore_check_on_paths: |-
                            $HOME/.gradle/caches/*.lock
                            ./.gradle/*.lock
                            ./.gradle/*.bin
            - slack:
                  inputs:
                      - channel: "#notif-deploy-mobile"
                      - channel_on_error: "#notif-deploy-mobile"
                      - webhook_url: "$SLACK_WEBHOOK"
    deploy:
        steps:
            - activate-ssh-key@4.0.3:
                  run_if: '{{getenv "SSH_RSA_PRIVATE_KEY" | ne ""}}'
            - git-clone@4.0.14: {}
            - cache-pull: {}
            - install-bundler@1.0.0: {}
            - fastlane@2.4.0:
                  inputs:
                      - lane: android deploy
            - cache-push:
                  inputs:
                      - cache_paths: |-
                            $HOME/.gradle
                            ./.gradle
                      - ignore_check_on_paths: |-
                            $HOME/.gradle/caches/*.lock
                            ./.gradle/*.lock
                            ./.gradle/*.bin
            - slack:
                  inputs:
                      - channel: "#notif-deploy-mobile"
                      - channel_on_error: "#notif-deploy-mobile"
                      - webhook_url: "$SLACK_WEBHOOK"
